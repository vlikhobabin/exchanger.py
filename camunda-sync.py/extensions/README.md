# üîß BPMN Converter Extensions

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö BPMN –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–†–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞. –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
extensions/
‚îú‚îÄ‚îÄ README.md                      # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ __init__.py                    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îî‚îÄ‚îÄ {Process_ID}/                  # –ü–∞–ø–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
    ‚îú‚îÄ‚îÄ __init__.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
    ‚îî‚îÄ‚îÄ process_extension.py       # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞**: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç ID –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑ BPMN XML (`<bpmn:process id="...">`)
2. **–ü–æ–∏—Å–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –ò—â–µ—Ç –ø–∞–ø–∫—É `extensions/{Process_ID}/process_extension.py`
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
4. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—ã–∑—ã–≤–∞–µ—Ç `pre_process()` –î–û —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
5. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
6. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—ã–∑—ã–≤–∞–µ—Ç `post_process()` –ü–û–°–õ–ï —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

## üìù –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_PROCESS_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID)
mkdir -p extensions/YOUR_PROCESS_ID

# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã
touch extensions/YOUR_PROCESS_ID/__init__.py
touch extensions/YOUR_PROCESS_ID/process_extension.py
```

### 2. –®–∞–±–ª–æ–Ω –º–æ–¥—É–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞: YOUR_PROCESS_ID
–ù–∞–∑–≤–∞–Ω–∏–µ: –í–∞—à–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
"""

import xml.etree.ElementTree as ET
from typing import Optional, Any


def pre_process(root: ET.Element, converter) -> None:
    """
    –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ö–µ–º—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π)
    
    Args:
        root: –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç BPMN XML
        converter: –≠–∫–∑–µ–º–ø–ª—è—Ä BPMNConverter –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥–∞–º –∏ namespaces
    """
    print("üîß [EXTENSION] –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ YOUR_PROCESS_ID...")
    
    # –í–ê–® –ö–û–î –ü–†–ï–î–û–ë–†–ê–ë–û–¢–ö–ò –ó–î–ï–°–¨
    
    print("   ‚úÖ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")


def post_process(root: ET.Element, converter) -> None:
    """
    –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ö–µ–º—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π)
    
    Args:
        root: –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç BPMN XML (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏)
        converter: –≠–∫–∑–µ–º–ø–ª—è—Ä BPMNConverter –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥–∞–º –∏ namespaces
    """
    print("üîß [EXTENSION] –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ YOUR_PROCESS_ID...")
    
    # –í–ê–® –ö–û–î –ü–û–°–¢–û–ë–†–ê–ë–û–¢–ö–ò –ó–î–ï–°–¨
    
    print("   ‚úÖ –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")


# –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
EXTENSION_INFO = {
    "process_id": "YOUR_PROCESS_ID",
    "process_name": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞",
    "version": "1.0.0",
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π",
    "author": "–í–∞—à–µ –∏–º—è",
    "created": "2024-01-15"
}
```

## üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ß–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `converter`:

- `converter.namespaces` - —Å–ª–æ–≤–∞—Ä—å —Å BPMN namespaces
- `converter._make_request()` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞
- `converter.assignees_data` - –¥–∞–Ω–Ω—ã–µ –æ–± –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)
- `converter.removed_elements` - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `converter.removed_flows` - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

### –ß–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `root`:

- –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç BPMN XML –¥–ª—è –ø—Ä—è–º–æ–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å—Ö–µ–º—ã —á–µ—Ä–µ–∑ XPath

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤

```python
def pre_process(root: ET.Element, converter) -> None:
    # –ù–∞–π—Ç–∏ –≤—Å–µ userTask –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
    user_tasks = root.findall('.//bpmn:userTask', converter.namespaces)
    for task in user_tasks:
        task_name = task.get('name', '')
        if '—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ' in task_name.lower():
            task.set('camunda:assignee', 'approver-group')
            task.set('camunda:candidateGroups', 'managers')
```

### –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö serviceTask

```python
def post_process(root: ET.Element, converter) -> None:
    # –î–æ–±–∞–≤–∏—Ç—å retry –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ –≤—Å–µ–º –≤–Ω–µ—à–Ω–∏–º –∑–∞–¥–∞—á–∞–º
    service_tasks = root.findall('.//bpmn:serviceTask', converter.namespaces)
    for task in service_tasks:
        if task.get(f'{{{converter.namespaces["camunda"]}}}type') == 'external':
            task.set(f'{{{converter.namespaces["camunda"]}}}asyncBefore', 'true')
            task.set(f'{{{converter.namespaces["camunda"]}}}retries', '3')
```

### –†–∞–±–æ—Ç–∞ —Å —É—Å–ª–æ–≤–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏

```python
def post_process(root: ET.Element, converter) -> None:
    # –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —É—Å–ª–æ–≤–∏–π –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
    for flow in root.findall('.//bpmn:sequenceFlow', converter.namespaces):
        flow_name = flow.get('name', '').lower()
        if flow_name == '—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ':
            # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ —É—Å–ª–æ–≤–∏–µ
            old_condition = flow.find('bpmn:conditionExpression', converter.namespaces)
            if old_condition is not None:
                flow.remove(old_condition)
            
            # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —É—Å–ª–æ–≤–∏–µ
            condition = ET.SubElement(flow, f'{{{converter.namespaces["bpmn"]}}}conditionExpression')
            condition.set(f'{{{converter.namespaces["xsi"]}}}type', 'bpmn:tFormalExpression')
            condition.text = '${customVariable == "special_value"}'
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ try-catch –±–ª–æ–∫–∞—Ö, –æ—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
2. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: pre_process ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã ‚Üí post_process
3. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç —Å–≤–æ–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞

## üìä –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

- `Process_1d4oa6g46/` - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üîç –û—Ç–ª–∞–¥–∫–∞

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[EXTENSION]` –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –≤—ã–≤–æ–¥–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞.

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å ID: Process_1d4oa6g46
üîß –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ Process_1d4oa6g46...
   üìã –ù–∞–∑–≤–∞–Ω–∏–µ: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   üì¶ –í–µ—Ä—Å–∏—è: 1.0.0
   ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
üîß [EXTENSION] –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ Process_1d4oa6g46...
   ‚úÖ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
... —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
üîß [EXTENSION] –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ Process_1d4oa6g46...
   ‚úÖ –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
``` 