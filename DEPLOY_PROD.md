# Инструкция по развертыванию Exchanger.py на Production сервере

Это руководство поможет вам развернуть проект `Exchanger.py` из репозитория GitHub на "чистый" сервер Ubuntu 24.04.

## 1. Подготовка сервера

Перед установкой убедитесь, что на вашем сервере установлены все необходимые пакеты.

### 1.1. Обновление пакетов и установка зависимостей

Подключитесь к вашему серверу по SSH и выполните следующие команды для обновления списка пакетов и установки `git`, `python3`, `pip` и `venv`:

```bash
sudo apt-get update
sudo apt-get install -y git python3-pip python3-venv
```

## 2. Клонирование репозитория

Рекомендуется устанавливать приложение в директорию `/opt/exchanger.py`.

### 2.1. Создание директории и клонирование

1.  Создайте директорию для проекта и сделайте вашего пользователя ее владельцем. Замените `<your_user>` на ваше имя пользователя на сервере (обычно можно использовать переменную `$USER`).

```bash
sudo mkdir -p /opt/exchanger.py
sudo chown $USER:$USER /opt/exchanger.py
```

2.  Перейдите в созданную директорию и клонируйте репозиторий:

```bash
cd /opt/exchanger.py
git clone https://github.com/vlikhobabin/exchanger.py.git .
```
    *Примечание: Точка в конце команды `git clone` указывает, что репозиторий нужно клонировать в текущую директорию (`/opt/exchanger.py`).*

## 3. Настройка окружения

### 3.1. Создание Python Virtual Environment

Для изоляции зависимостей проекта рекомендуется использовать виртуальное окружение. Находясь в `/opt/exchanger.py`:

```bash
python3 -m venv venv
source venv/bin/activate
```
*После активации окружения, в начале командной строки появится `(venv)`. Все последующие команды, связанные с Python, выполняйте в этом окружении.*

### 3.2. Установка зависимостей

В корне проекта находится файл `requirements.txt`, содержащий все необходимые Python-библиотеки. Установите их:

```bash
pip install -r requirements.txt
```

### 3.3. Создание файла конфигурации `.env`

Проект использует единый файл `.env` в корневой директории для конфигурации всех сервисов.

1.  **Создайте `.env` файл из примера:**
    Находясь в `/opt/exchanger.py`:
```bash
cp config.env.example .env
```

2.  **Настройте переменные:**
    Теперь вам нужно перенести ваши секретные ключи и настройки в этот файл. Самый простой способ - отредактировать созданный файл на сервере с помощью текстового редактора (например, `nano`) и вставить в него содержимое вашего локального файла `.env`.

```bash
nano .env
```
    Скопируйте содержимое с вашего локального компьютера, вставьте в редактор `nano`, затем нажмите `Ctrl+X`, `Y` и `Enter` для сохранения. Убедитесь, что вы заполнили все необходимые переменные для Camunda, RabbitMQ и StormBPMN.

## 4. Обновление приложения

Так как репозиторий был клонирован с помощью `git`, вы можете легко обновлять файлы на сервере.

Для получения последних изменений из репозитория GitHub, выполните следующие команды:

```bash
cd /opt/exchanger.py
git pull origin master
```

Если после обновления изменился файл `requirements.txt`, не забудьте обновить зависимости (убедитесь, что виртуальное окружение активировано):
```bash
source venv/bin/activate
pip install -r requirements.txt
```

## 5. Следующие шаги

После выполнения этих шагов, код проекта будет развернут на вашем сервере. Следующим этапом будет настройка и запуск сервисов `universal-worker` и `task-creator` в качестве системных служб (`systemd`), чтобы они работали в фоновом режиме и автоматически запускались после перезагрузки сервера. 