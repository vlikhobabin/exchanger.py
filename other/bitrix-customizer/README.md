# Bitrix24 Custom Task Modifier

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–∞—Å—Ç–æ–º–Ω—ã–π JavaScript –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è Bitrix24, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –Ω–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º" –¥–ª—è –∑–∞–¥–∞—á —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º `UF_RESULT_EXPECTED=true`.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–¥–∞—á–∏ —Å —Ç—Ä–µ–±—É–µ–º—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
- **–ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞**: –ó–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –Ω–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º"
- **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å –≤–æ–ø—Ä–æ—Å–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ "–î–∞/–ù–µ—Ç/–û—Ç–º–µ–Ω–∞"
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞**: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –≤ –ø–æ–ª–µ `UF_RESULT_ANSWER` (—Ç–∏–ø "–°–ø–∏—Å–æ–∫")
- **–ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–ª–∞–π–¥–µ—Ä –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- `global_task_modifier.js` - –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –∫–æ–¥
- `deploy.py` - Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- `update_js_config.py` - –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ JS
- `quick_deploy.py` - –ú–∞—Å—Ç–µ—Ä-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è (–≤—Å—ë –≤ –æ–¥–Ω–æ–º)
- `check_auth.py` - –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `setup.py` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `config.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–ª–µ–π ‚ö†Ô∏è
- `config.example.json` - –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `SECURITY.md` - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `copy_js_to_server.cmd` - –°—Ç–∞—Ä—ã–π batch —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è (—É—Å—Ç–∞—Ä–µ–ª)
- `castom_battom.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

> ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –§–∞–π–ª—ã —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (`config.json`, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏) –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore` –∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
python setup.py
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞
- –ü–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π
- –ó–∞–ø—É—Å—Ç–∏—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

### –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:**
   ```bash
   cp config.example.json config.json
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - –û–±–Ω–æ–≤–∏—Ç–µ IP —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—É—Ç–∏
   - –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–ª—é—á–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `~/.ssh/your-key.ppk`)
   - –û–±–Ω–æ–≤–∏—Ç–µ ID –ø–æ–ª–µ–π Bitrix24

3. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ:**
   ```bash
   # Windows
   mkdir C:\Users\%USERNAME%\.ssh
   move your-key.ppk C:\Users\%USERNAME%\.ssh\
   
   # Linux/macOS
   mkdir -p ~/.ssh
   mv your-key.ppk ~/.ssh/
   chmod 600 ~/.ssh/your-key.ppk
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   ```bash
   python check_auth.py
   ```

## –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

### –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ + –¥–µ–ø–ª–æ–π
python quick_deploy.py
```

### –ü–æ—à–∞–≥–æ–≤—ã–π —Å–ø–æ—Å–æ–±

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ JS —Ñ–∞–π–ª–µ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å ID –ø–æ–ª–µ–π)
python update_js_config.py

# –ó–∞–ø—É—Å–∫ Python —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –¥–µ–ø–ª–æ—è
python deploy.py
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python check_auth.py
```

### –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
```cmd
copy_js_to_server.cmd
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `config.json`. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID –ø–æ–ª–µ–π –≤ Bitrix24:

1. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `config.json`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python update_js_config.py` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è JavaScript –∫–æ–¥–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python deploy.py` –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –∫–ª—é—á–∞ (.ppk) –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º
2. –û–±–Ω–æ–≤–∏—Ç–µ `config.json`:
   ```json
   {
     "server": {
       "host": "31.129.105.41",
       "user": "root",
       "path": "/home/bitrix/www/local/templates/bitrix24/assets/js/",
       "key_file": "privete-key.ppk",
       "auth_method": "key"
     }
   }
   ```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **PSCP** (PuTTY) - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å .ppk —Ñ–∞–π–ª–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é
- **SCP** (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π) - —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ .ppk –≤ OpenSSH —Ñ–æ—Ä–º–∞—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** - —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç .ppk –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python check_auth.py` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PuTTY –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ .ppk –∫–ª—é—á–∏:
   ```bash
   choco install putty
   ```
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WSL —Å SSH –∫–ª–∏–µ–Ω—Ç–æ–º

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ**: –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](SECURITY.md) –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º!

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ (`~/.ssh/`)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –ø–æ–º–æ—â—å—é `python check_auth.py`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.6+ (–¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è)
- SSH –∫–ª–∏–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π scp
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É Bitrix24

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—è UF_RESULT_ANSWER

–ü–æ–ª–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∏–ø–∞ "–°–ø–∏—Å–æ–∫" —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

| ID | XML_ID | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----|--------|----------|
| 26 | 19c029c38d3abebea4e17ec6ef476a99 | –î–ê |
| 27 | bcaf5a864e49d804190afa3637e5b394 | –ù–ï–¢ |

## –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

- **v12**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª–µ–º UF_RESULT_ANSWER —Ç–∏–ø–∞ "–°–ø–∏—Å–æ–∫"
- **v11**: –í–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä—è–º–æ–º—É –≤—ã–∑–æ–≤—É –º–µ—Ç–æ–¥–æ–≤, –Ω–æ —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–ª–∞–π–¥–µ—Ä–∞
- **v10 –∏ —Ä–∞–Ω–µ–µ**: –†–∞–∑–ª–∏—á–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ–∞–π–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∫ —à–∞–±–ª–æ–Ω—É:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/home/bitrix/www/local/templates/bitrix24/footer.php`
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ `</body>`:
   ```php
   <script src="<?=SITE_TEMPLATE_PATH?>/assets/js/global_task_modifier.js?v=<?=time()?>"></script>
   ```
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à Bitrix24 