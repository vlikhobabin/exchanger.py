# Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ñ… Ð¿Ð¾Ð»ÐµÐ¹

## ÐžÐ±Ð·Ð¾Ñ€

Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ `UF_RESULT_ANSWER` Ð¸Ð· Bitrix24 API Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ `tracker.py`. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ fallback Ð½Ð° ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ API.

## ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹

### 1. userfield_sync.py
ÐÐ¾Ð²Ñ‹Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ `BitrixUserFieldSync` Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¼Ð¸ Ð¿Ð¾Ð»ÑÐ¼Ð¸:

- **fetch_uf_result_answer_values()** - Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº API Bitrix24
- **parse_list_values()** - Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ ÑÐ¿Ð¸ÑÐºÐ°
- **build_mapping()** - ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð° ID â†’ Ñ‚ÐµÐºÑÑ‚
- **save_to_cache_file()** - ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð»
- **load_from_cache_file()** - Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð· ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð»Ð°
- **sync_mapping()** - Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸

### 2. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ config.py
- Ð£Ð±Ñ€Ð°Ð½ hardcoded Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³ `uf_result_answer_mapping`
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¿ÑƒÑ‚ÑŒ Ðº ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð»Ñƒ `uf_cache_file`

### 3. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ tracker.py
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¼ÐµÑ‚Ð¾Ð´ `_sync_user_fields()` Ð² `__init__`
- Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¾ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² `_update_response_data()`

## Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

1. **ÐŸÑ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ tracker.py** Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ `_sync_user_fields()`
2. **ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° API**: Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº `user.userfield.list` Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»Ñ `UF_RESULT_ANSWER`
3. **ÐŸÑ€Ð¸ ÑƒÑÐ¿ÐµÑ…Ðµ**: ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð» Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
4. **ÐŸÑ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ API**: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð· ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð»Ð°
5. **Ð•ÑÐ»Ð¸ ÐºÐµÑˆ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚**: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ fallback Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹

## ÐšÐµÑˆ-Ñ„Ð°Ð¹Ð»

**Ð Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ**: `task-creator/consumers/bitrix/.uf_result_answer_cache.json`

**Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°**:
```json
{
  "last_updated": "2025-10-18T12:00:00",
  "mapping": {
    "26": "Ð”Ð",
    "27": "ÐÐ•Ð¢"
  }
}
```

## API Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ

**Endpoint**: `{BITRIX_WEBHOOK_URL}/user.userfield.list.json`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹**:
```json
{
  "filter": {
    "ENTITY_ID": "TASKS_TASK",
    "FIELD_NAME": "UF_RESULT_ANSWER"
  }
}
```

## ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº

- **API Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½** â†’ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð· ÐºÐµÑˆÐ° â†’ warning
- **ÐšÐµÑˆ Ð¿Ð¾Ð²Ñ€ÐµÐ¶Ð´ÐµÐ½** â†’ fallback Ð¸Ð· config â†’ error
- **ÐŸÐ¾Ð»Ðµ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾** â†’ critical error, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
- **ÐÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°** â†’ error Ñ Ð´ÐµÑ‚Ð°Ð»ÑÐ¼Ð¸

## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

Ð¡Ð¾Ð·Ð´Ð°Ð½ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸:
- âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ ÐºÐµÑˆ-Ñ„Ð°Ð¹Ð»Ð°
- âœ… ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
- âœ… Ð ÐµÐ·Ð¾Ð»Ð²Ð¸Ð½Ð³ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ `BitrixTaskTracker`. ÐÐ¸ÐºÐ°ÐºÐ¸Ñ… Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ.

## ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² Ð½Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹:
- `âœ… UF_RESULT_ANSWER Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½`
- `âš ï¸ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³ UF_RESULT_ANSWER`
- `ðŸ” Ð ÐµÐ·Ð¾Ð»Ð²Ð¸Ð½Ð³ UF_RESULT_ANSWER: {id} -> {text}`
