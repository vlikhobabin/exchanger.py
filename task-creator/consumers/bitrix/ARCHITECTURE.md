# –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ `bitrix`

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ö–∞—Ç–∞–ª–æ–≥ `bitrix` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bitrix24 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Camunda BPM. –ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ RabbitMQ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É Camunda –∏ Bitrix24 —á–µ—Ä–µ–∑ REST API.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
bitrix/
‚îú‚îÄ‚îÄ handler.py              # –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á (2647 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ tracker.py              # –¢—Ä–µ–∫–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á (567 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ userfield_sync.py       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π (270 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è (58 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ __init__.py             # –≠–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ UF_SYNC_README.md       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–µ–π
‚îú‚îÄ‚îÄ .uf_result_answer_cache.json  # –ö–µ—à –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ properties_api/         # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–∏–∞–≥—Ä–∞–º–º
‚îÇ   ‚îî‚îÄ‚îÄ diagram.properties.md
‚îÇ
‚îú‚îÄ‚îÄ tasktemplate_api/       # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ test_tasktemplate_api.py
‚îÇ   ‚îú‚îÄ‚îÄ check_handler.php
‚îÇ   ‚îú‚îÄ‚îÄ register_tasktemplate_handler.php
‚îÇ   ‚îú‚îÄ‚îÄ register_user_supervisor_handler.php
‚îÇ   ‚îî‚îÄ‚îÄ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã]
‚îÇ
‚îî‚îÄ‚îÄ userfield_api/          # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏
    ‚îî‚îÄ‚îÄ USERFIELDS_API_GUIDE.md
```

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. `handler.py` - BitrixTaskHandler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ RabbitMQ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ Bitrix24.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

#### 1.1. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –ø–æ `UF_CAMUNDA_ID_EXTERNAL_TASK`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –í–æ–∑–≤—Ä–∞—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è

#### 1.2. –†–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–¥–∞—á
- –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —á–µ—Ä–µ–∑ API `imena.camunda.tasktemplate.get`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞: `camundaProcessId`, `elementId`
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - –ó–∞–≥–æ–ª–æ–≤–∫–∞, –æ–ø–∏—Å–∞–Ω–∏—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
  - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π)
  - –ü—Ä–æ–µ–∫—Ç–æ–≤, –≥—Ä—É–ø–ø –∑–∞–¥–∞—á
  - –ß–µ–∫–ª–∏—Å—Ç–æ–≤
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π (UF_*)
  - –§–∞–π–ª–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–∞

#### 1.3. Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —à–∞–±–ª–æ–Ω–∞
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Camunda
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### 1.4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ UF_ –ø–æ–ª–µ–π –∏–∑ `metadata.extensionProperties`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–µ–π:
  - `UF_RESULT_EXPECTED` (boolean: –î–∞/–ù–µ—Ç)
  - `UF_RESULT_QUESTION` (string: –í–æ–ø—Ä–æ—Å)
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `supported_user_fields`

#### 1.5. –†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º Camunda
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º

#### 1.6. –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ –∑–∞–¥–∞—á
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

#### 1.7. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Bitrix24
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- API –º–µ—Ç–æ–¥: `imena.camunda.sync`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `processDefinitionKey`, `processInstanceId`

#### 1.8. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `bitrix24.queue` —Å retry
- –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—à–∏–±–æ–∫ –≤ error queue
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ASSIGNEE_ID_ERROR`)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–æ–ø–∏–∫–∏:**
- `bitrix_create_task` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `bitrix_update_task` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `bitrix_create_deal` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏
- `bitrix_update_deal` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
- `bitrix_create_contact` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- `bitrix_create_lead` - –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–∞
- `bitrix_update_lead` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞
- `bitrix_create_company` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `bitrix_update_company` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É–¥–∞—á–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –ó–∞–ø—Ä–æ—Å—ã –∫ —à–∞–±–ª–æ–Ω–∞–º (–Ω–∞–π–¥–µ–Ω–æ/–Ω–µ –Ω–∞–π–¥–µ–Ω–æ/–æ—à–∏–±–∫–∏)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É–¥–∞—á–Ω—ã–µ)
- –§–∞–π–ª—ã (–Ω–∞–π–¥–µ–Ω–æ/–ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ/–æ—à–∏–±–∫–∏)

---

### 2. `tracker.py` - BitrixTaskTracker

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á –≤ Bitrix24 –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –æ–±—Ä–∞—Ç–Ω–æ –≤ Camunda.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

#### 2.1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–∏
- –ß—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `bitrix24.sent.queue`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –¥–æ 50 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `auto_ack=False` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

#### 2.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á
- –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `tasks.task.get.json`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤: `4` (–í—ã–ø–æ–ª–Ω–µ–Ω–∞), `5` (–û—Ç–∫–ª–æ–Ω–µ–Ω–∞)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π:
  - `UF_RESULT_EXPECTED`
  - `UF_RESULT_QUESTION`
  - `UF_RESULT_ANSWER`

#### 2.3. –†–µ–∑–æ–ª–≤–∏–Ω–≥ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–µ–π
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞ `UF_RESULT_ANSWER`
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ID –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- Fallback –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

#### 2.4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ `camunda.responses.queue`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ dead letter queue –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

#### 2.5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Heartbeat –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∑–∞–¥–∞—á
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- –£—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ
- –ù–µ—É–¥–∞—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫

---

### 3. `userfield_sync.py` - BitrixUserFieldSync

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π –∏–∑ Bitrix24 API.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

#### 3.1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
- –ó–∞–ø—Ä–æ—Å –∫ `imena.camunda.userfield.list`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—è `UF_RESULT_ANSWER` —Å enum –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API

#### 3.2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ `.uf_result_answer_cache.json`
- –§–æ—Ä–º–∞—Ç: `{"last_updated": "ISO datetime", "mapping": {"ID": "VALUE"}}`
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–µ—à–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

#### 3.3. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è ID ‚Üí —Ç–µ–∫—Å—Ç –¥–ª—è enum –∑–Ω–∞—á–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `BitrixTaskTracker`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `bitrix_config.uf_result_answer_mapping`

---

### 4. `config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è Bitrix24.

**–ö–ª–∞—Å—Å—ã:**

#### 4.1. BitrixConfig
```python
- webhook_url: str                    # URL webhook Bitrix24
- default_responsible_id: int         # –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- default_priority: int               # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- request_timeout: int                # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫—É–Ω–¥—ã)
- max_description_length: int         # –ú–∞–∫—Å. –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è
- uf_result_answer_mapping: Dict      # –ú–∞–ø–ø–∏–Ω–≥ UF_RESULT_ANSWER (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
- uf_cache_file: str                  # –ü—É—Ç—å –∫ –∫–µ—à-—Ñ–∞–π–ª—É
```

#### 4.2. WorkerConfig
```python
- log_level: str                      # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- retry_attempts: int                 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞
- retry_delay: int                    # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- heartbeat_interval: int             # –ò–Ω—Ç–µ—Ä–≤–∞–ª heartbeat
- max_messages_per_batch: int         # –ú–∞–∫—Å. —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –±–∞—Ç—á–µ
- message_processing_timeout: int     # –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
```

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
- `SUPPORTED_TOPICS: List[str]` - –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ç–æ–ø–∏–∫–æ–≤

---

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

```
Camunda ‚Üí RabbitMQ (bitrix24.queue)
    ‚Üì
BitrixTaskHandler.process_message()
    ‚Üì
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (UF_CAMUNDA_ID_EXTERNAL_TASK)
    ‚Üì
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (imena.camunda.tasktemplate.get)
    ‚Üì
3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ task_data –∏–∑ —à–∞–±–ª–æ–Ω–∞ + –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    ‚Üì
4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (tasks.task.add.json)
    ‚Üì
5. –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ —à–∞–±–ª–æ–Ω–µ)
    ‚Üì
6. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ bitrix24.sent.queue
    ‚Üì
7. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (imena.camunda.sync)
```

### –ü–æ—Ç–æ–∫ 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

```
BitrixTaskTracker
    ‚Üì
1. –ß—Ç–µ–Ω–∏–µ –∏–∑ bitrix24.sent.queue
    ‚Üì
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ (tasks.task.get.json)
    ‚Üì
3. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω (4 –∏–ª–∏ 5):
    - –†–µ–∑–æ–ª–≤–∏–Ω–≥ UF_RESULT_ANSWER
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∏
    - ACK —Å–æ–æ–±—â–µ–Ω–∏—è
    - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ camunda.responses.queue
    ‚Üì
4. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω:
    - NACK + requeue (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∂–µ)
```

### –ü–æ—Ç–æ–∫ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π

```
BitrixTaskTracker.__init__()
    ‚Üì
BitrixUserFieldSync.sync_mapping()
    ‚Üì
1. –ó–∞–ø—Ä–æ—Å –∫ API (imena.camunda.userfield.list)
    ‚Üì
2. –ü–∞—Ä—Å–∏–Ω–≥ UF_RESULT_ANSWER enum –∑–Ω–∞—á–µ–Ω–∏–π
    ‚Üì
3. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ ID ‚Üí —Ç–µ–∫—Å—Ç
    ‚Üì
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à-—Ñ–∞–π–ª
    ‚Üì
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ bitrix_config.uf_result_answer_mapping
```

---

## üîå API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Bitrix24 REST API –º–µ—Ç–æ–¥—ã

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- `tasks.task.add.json` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `tasks.task.get.json` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `tasks.task.update.json` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `tasks.task.getfiles.json` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∑–∞–¥–∞—á–∏

#### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã (imena.camunda.*)
- `imena.camunda.tasktemplate.get` - –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∑–∞–¥–∞—á–∏
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `camundaProcessId`, `elementId`
- `imena.camunda.userfield.list` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
- `imena.camunda.userfield.get` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è
- `imena.camunda.sync` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `processDefinitionKey`, `processInstanceId`
- `imena.camunda.user.supervisor` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (RabbitMQ)

```json
{
  "task_id": "external-task-id",
  "topic": "bitrix_create_task",
  "processInstanceId": "process-instance-id",
  "processDefinitionKey": "process-definition-key",
  "variables": {
    "title": {"value": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏", "type": "String"},
    "assigneeId": {"value": "123", "type": "Long"},
    "projectManagerId": {"value": "456", "type": "Long"},
    "startedBy": {"value": "789", "type": "Long"}
  },
  "metadata": {
    "extensionProperties": {
      "UF_RESULT_EXPECTED": "true",
      "UF_RESULT_QUESTION": "–í–æ–ø—Ä–æ—Å –¥–ª—è –∑–∞–¥–∞—á–∏",
      "assigneeId": "123"
    },
    "activityInfo": {
      "name": "–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
    },
    "processProperties": {
      "property1": {"value": "value1"},
      "property2": {"value": "value2"}
    }
  }
}
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏

```json
{
  "response_data": {
    "result": {
      "task": {
        "id": "12345",
        "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
        "status": 2,
        "createdBy": "789",
        "responsibleId": "123"
      }
    }
  }
}
```

### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è Camunda

```json
{
  "task_id": "external-task-id",
  "bitrix_task_id": "12345",
  "status": "4",
  "completedDate": "2024-01-01T12:00:00",
  "UF_RESULT_ANSWER": "26",
  "UF_RESULT_ANSWER_TEXT": "–î–ê",
  "response_data": {
    "result": {
      "task": {
        "id": "12345",
        "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
        "status": 4,
        "closedDate": "2024-01-01T12:00:00"
      }
    }
  }
}
```

---

## üîí –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫

#### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (ACK —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ error queue)
- `ASSIGNEE_ID_ERROR` - –û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏

#### 2. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (NACK + requeue)
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API Bitrix24
- –¢–∞–π–º–∞—É—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

#### 3. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–æ–π `UF_CAMUNDA_ID_EXTERNAL_TASK`
- –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ—ë –¥–∞–Ω–Ω—ã–µ

### –ú–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

1. **Retry –º–µ—Ö–∞–Ω–∏–∑–º**
   - –î–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏

2. **Dead Letter Queue**
   - –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫
   - –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∏–∞–≥—Ä–∞–º–º Camunda
   - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∏ BitrixTaskHandler

```python
{
  "total_messages": int,              # –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  "successful_tasks": int,            # –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ
  "failed_tasks": int,                # –û—à–∏–±–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è
  "sent_to_success_queue": int,       # –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ success queue
  "failed_to_send_success": int,      # –û—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
  "sync_requests_sent": int,          # –£—Å–ø–µ—à–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
  "sync_requests_failed": int,        # –û—à–∏–±–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  "templates_requested": int,         # –ó–∞–ø—Ä–æ—Å–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤
  "templates_found": int,             # –®–∞–±–ª–æ–Ω–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
  "templates_not_found": int,         # –®–∞–±–ª–æ–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
  "templates_api_errors": int,        # –û—à–∏–±–æ–∫ API —à–∞–±–ª–æ–Ω–æ–≤
  "template_files_found": int,        # –§–∞–π–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
  "template_files_attached": int,     # –§–∞–π–ª–æ–≤ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ
  "template_files_failed": int,       # –û—à–∏–±–æ–∫ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è
  "uptime_seconds": float,            # –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
  "success_rate": float,              # –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞
  "messages_per_minute": float        # –°–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ BitrixTaskTracker

```python
{
  "start_time": float,                # –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞
  "total_checked": int,               # –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
  "completed_tasks": int,             # –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
  "moved_to_responses": int,          # –£—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ
  "failed_moves": int,                # –û—à–∏–±–æ–∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
  "failed_checks": int,               # –û—à–∏–±–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
  "last_check_time": float,           # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
  "errors": List[str]                 # –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
}
```

---

## üõ†Ô∏è API –º–æ–¥—É–ª–∏

### 1. properties_api/

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–∏–∞–≥—Ä–∞–º–º Camunda ‚Üí Bitrix24.

**–§–∞–π–ª—ã:**
- `diagram.properties.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º –≤ `handler.py`
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏

---

### 2. tasktemplate_api/

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–¥–∞—á –≤ Bitrix24.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `test_tasktemplate_api.py` - –¢–µ—Å—Ç—ã API
- `check_handler.php` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `register_tasktemplate_handler.php` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
- `register_user_supervisor_handler.php` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**API –º–µ—Ç–æ–¥—ã:**
- `imena.camunda.tasktemplate.get` - –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∑–∞–¥–∞—á–∏
- `imena.camunda.user.supervisor` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞:**
```json
{
  "template": {
    "TITLE": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
    "DESCRIPTION": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
    "PRIORITY": "2",
    "GROUP_ID": "10",
    "CREATED_BY": "789",
    "CREATED_BY_USE_SUPERVISOR": "Y",
    "RESPONSIBLE_ID": "123"
  },
  "files": [
    {
      "id": "file-id",
      "name": "file-name.pdf",
      "downloadUrl": "https://..."
    }
  ],
  "members": {
    "by_type": {
      "R": ["123", "456"]  // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ
    }
  },
  "tags": ["tag1", "tag2"],
  "checklists": [
    {
      "title": "–ß–µ–∫–ª–∏—Å—Ç",
      "items": [
        {"title": "–ü—É–Ω–∫—Ç 1", "isComplete": false}
      ]
    }
  ]
}
```

---

### 3. userfield_api/

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ –∑–∞–¥–∞—á.

**–§–∞–π–ª—ã:**
- `USERFIELDS_API_GUIDE.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ API

**API –º–µ—Ç–æ–¥—ã:**
- `imena.camunda.userfield.list` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª–µ–π
- `imena.camunda.userfield.get` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è
- `imena.camunda.userfield.stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–æ–ª–µ–π

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π:**
- `string` - –°—Ç—Ä–æ–∫–∞
- `enumeration` - –°–ø–∏—Å–æ–∫ (—Å enum –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)
- `boolean` - –î–∞/–ù–µ—Ç
- `crm` - –°–≤—è–∑—å —Å CRM
- `disk_file` - –§–∞–π–ª
- `iblock_element` - –≠–ª–µ–º–µ–Ω—Ç –∏–Ω—Ñ–æ–±–ª–æ–∫–∞
- `mail_message` - –ü–æ—á—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Webhook URL —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `pydantic-settings` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `.env` —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `python-dotenv`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `loguru` - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `DEBUG` - –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `INFO` - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- `WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (—à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, fallback)
- `ERROR` - –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `CRITICAL` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (ASSIGNEE_ID_ERROR, –ø–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- Heartbeat –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `tracker.py` –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```python
- requests          # HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Bitrix24 API
- pika              # RabbitMQ –∫–ª–∏–µ–Ω—Ç
- loguru            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- pydantic-settings # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- python-dotenv     # –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Bitrix24
BITRIX_WEBHOOK_URL=https://bx.eg-holding.ru/rest/1/xxx
BITRIX_DEFAULT_RESPONSIBLE_ID=1
BITRIX_DEFAULT_PRIORITY=2
BITRIX_REQUEST_TIMEOUT=30
BITRIX_MAX_DESCRIPTION_LENGTH=10000

# Worker
LOG_LEVEL=INFO
RETRY_ATTEMPTS=3
RETRY_DELAY=5
HEARTBEAT_INTERVAL=60
MAX_MESSAGES_PER_BATCH=10
MESSAGE_PROCESSING_TIMEOUT=120
```

### RabbitMQ –æ—á–µ—Ä–µ–¥–∏
- `bitrix24.queue` - –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á
- `bitrix24.sent.queue` - –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `camunda.responses.queue` - –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Camunda
- Error queue - –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `README.md` - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
- `UF_SYNC_README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
- `userfield_api/USERFIELDS_API_GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
- `tasktemplate_api/` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã API —à–∞–±–ª–æ–Ω–æ–≤

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ** (BitrixTaskHandler)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ `bitrix24.queue`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∏–ª–∏ fallback
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ Bitrix24
   - –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ `bitrix24.sent.queue`
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º

2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** (BitrixTaskTracker)
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ `bitrix24.sent.queue`
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   - –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—Å—Ç–∞—Ç—É—Å 4 –∏–ª–∏ 5)

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**
   - –†–µ–∑–æ–ª–≤–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ `camunda.responses.queue`
   - ACK —Å–æ–æ–±—â–µ–Ω–∏—è

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
2. **–®–∞–±–ª–æ–Ω—ã** - –≥–∏–±–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
3. **Fallback** - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
5. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
7. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π
8. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (loguru)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞/—Ç—Ä–µ–∫–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Bitrix24 API
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å webhook URL
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞: 2025-01-19*
*–í–µ—Ä—Å–∏—è –º–æ–¥—É–ª—è: 2.0*

