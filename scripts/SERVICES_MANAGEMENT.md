# Управление сервисами Exchanger.py

В этом документе описано, как установить и управлять сервисами `universal-worker` и `task-creator` на вашем сервере с помощью `systemd`.

## Установка сервисов

Для автоматической установки, настройки и запуска сервисов выполните следующий скрипт из корневой директории проекта:

```bash
# Сделайте все управляющие скрипты исполняемыми
chmod +x scripts/*.sh

# Запустите установщик
./scripts/install_services.sh
```

Этот скрипт выполнит следующие действия:
1.  Создаст `systemd` unit-файлы для `exchanger-worker` и `exchanger-creator`.
2.  Разместит их в `/etc/systemd/system/`.
3.  Перезагрузит `systemd` daemon для обнаружения новых сервисов.
4.  Включит сервисы для автоматического запуска при загрузке сервера.
5.  Запустит сервисы немедленно.

## Управление сервисами

Для управления сервисами были созданы удобные скрипты в папке `scripts/`.

### Запуск сервисов

Чтобы запустить оба сервиса (например, после остановки для обслуживания):
```bash
./scripts/start_services.sh
```

### Остановка сервисов

Для остановки обоих сервисов:
```bash
./scripts/stop_services.sh
```

### Перезапуск сервисов

Чтобы перезапустить сервисы (например, после обновления кода через `git pull`):
```bash
./scripts/restart_services.sh
```

### Проверка статуса

Чтобы проверить текущее состояние обоих сервисов, включая последние записи из логов:
```bash
./scripts/status_services.sh
```

## Просмотр логов

Все логи сервисов пишутся в системный журнал `journald`. Для их просмотра используйте команду `journalctl`:

### Просмотр логов в реальном времени (на сервере)

#### Просмотр логов Universal Worker
```bash
# Показать последние 100 строк лога
journalctl -u exchanger-worker -n 100

# Следить за логом в реальном времени
journalctl -u exchanger-worker -f
```

#### Просмотр логов Task Creator
```bash
# Показать последние 100 строк лога
journalctl -u exchanger-creator -n 100

# Следить за логом в реальном времени
journalctl -u exchanger-creator -f
```

### Экспорт и скачивание логов

Для удобного анализа вы можете экспортировать логи в текстовые файлы на сервере, а затем скачать их на свой компьютер.

**Шаг 1: Экспорт логов на сервере**

Подключитесь к вашему VPS и выполните скрипт:
```bash
./scripts/export_logs.sh
```
Эта команда создаст два файла в вашей домашней директории на сервере (`~/`):
- `exchanger-worker-logs.txt`
- `exchanger-creator-logs.txt`

**Шаг 2: Скачивание логов на Windows**

На вашем локальном компьютере с Windows запустите PowerShell скрипт:
```powershell
# Перейдите в директорию проекта
cd C:\path\to\your\exchanger.py
# Запустите скрипт
./scripts/download_logs.ps1
```
Скрипт использует `pscp` (из пакета PuTTY) для скачивания двух файлов логов с сервера в папку `logs/` внутри вашего проекта. Убедитесь, что PuTTY установлен и его путь добавлен в системные переменные PATH.

## Удаление сервисов

Если вам потребуется удалить сервисы с сервера (например, при миграции), используйте скрипт `uninstall_services.sh`.

```